{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Транзакции Т-Pass</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <button class="btn btn-sm btn-outline-primary me-2" id="uploadBtn">
            <i class="fas fa-upload"></i> Загрузить данные
        </button>
        <button class="btn btn-sm btn-outline-secondary" id="filterBtn">
            <i class="fas fa-filter"></i> Фильтр
        </button>
    </div>
</div>

<!-- Фильтры -->
<div class="row mb-3" id="filtersSection" style="display: none;">
    <div class="col-md-3">
        <label class="form-label">Транспондер</label>
        <input type="text" class="form-control" id="filterTransponder">
    </div>
    <div class="col-md-3">
        <label class="form-label">Дата с</label>
        <input type="date" class="form-control" id="filterDateFrom">
    </div>
    <div class="col-md-3">
        <label class="form-label">Дата по</label>
        <input type="date" class="form-control" id="filterDateTo">
    </div>
    <div class="col-md-3">
        <label class="form-label">ПВП</label>
        <input type="text" class="form-control" id="filterPVP">
    </div>
    <div class="col-md-12 mt-2">
        <button class="btn btn-primary btn-sm" id="applyFilters">Применить</button>
        <button class="btn btn-secondary btn-sm" id="clearFilters">Очистить</button>
    </div>
</div>

<!-- Таблица транзакций -->
<div class="table-responsive">
    <table class="table table-striped table-hover" id="transactionsTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Транспондер</th>
                <th>ПВП</th>
                <th>Дата</th>
                <th>Тариф</th>
                <th>Скидка</th>
                <th>Итог</th>
                <th>Статус</th>
            </tr>
        </thead>
        <tbody>
            {% for transaction in transactions %}
            <tr>
                <td>{{ transaction.id_transaction }}</td>
                <td>{{ transaction.transponder }}</td>
                <td>
                    <span class="badge bg-info">{{ transaction.PVP_code }}</span>
                </td>
                <td>{{ transaction.occurred_at }}</td>
                <td>₽{{ transaction.base_tariff }}</td>
                <td>
                    {% if transaction.discount %}
                    <span class="badge bg-success">-{{ transaction.discount }}%</span>
                    {% else %}
                    <span class="badge bg-secondary">0%</span>
                    {% endif %}
                </td>
                <td><strong>₽{{ transaction.paid }}</strong></td>
                <td>
                    {% if transaction.is_violation %}
                    <span class="badge violation-badge">Нарушение</span>
                    {% else %}
                    <span class="badge normal-badge">Норма</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Пагинация -->
<nav>
    <ul class="pagination justify-content-center" id="pagination">
        <!-- Пагинация генерируется через JavaScript -->
    </ul>
</nav>
{% endblock %}

{% block scripts %}
<script src="/static/js/transactions.js"></script>
{% endblock %}